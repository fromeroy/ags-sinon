<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>AGS Sinon.js nodejs community</title>

		<meta name="description" content="A presentation of Sinon.js created for Axa Group Solutions">
		<meta name="author" content="F. Javier Romero Yesares">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="shortcut icon" href="http://sinonjs.org/assets/images/logo.png" />

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/atelier-light.css" id="highlight-theme">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<img class="logo" src="http://sinonjs.org/assets/images/logo.png" style="border: 0; width: 200px; border-radius: 100px"/>
					<h1>Sinon.js</h1>
					<h3>Standalone test spies, stubs and mocks for JavaScript</h3>
					<p>
						<small>Created by <a href="mailto:francisco.romero.altran@axa-groupsolutions.com">F. Javier Romero Yesares</a> / <a href="https://github.com/fromeroy">fromeroy</a></small>
					</p>
					
				</section>
				
				<section data-background="https://media.giphy.com/media/zQc8STzaOlJ3q/giphy.gif">
				</section>
				
				<section>
					<section data-markdown>
						### Install using npm

						```
						npm install sinon
						```
					
					</section>
				</section>

				<section>
					<h3>Main features</h3>
					
					<p class="fragment">Spies</p>
					<p class="fragment">Stubs</p>
					<p class="fragment">Mocks</p>
					<p class="fragment">Fake timers</p>
					<p class="fragment">Fake XHR and servers</p>
					<p class="fragment">Sandboxes</p>
					
				</section>

				<section>
					<section>
					<h3>Spies</h3>
					<h4>What is a test spy?</h4>
					<p>A test spy is a function that records arguments, return value, the value of this and exception thrown (if any) for all its calls.</p>
					</section>
					
					<section>
						<h3>Spies</h3>
						<h4>Creating Spies</h4>
						<pre><code class="hljs" data-trim contenteditable>
function myFunction(fn) {
	return function () {
		return fn.apply(this, arguments);
	};
}
						</code></pre>
					</section>
					
					<section>
						<h3>Spies</h3>
						<h4>Creating Spies</h4>
						<pre><code class="hljs" data-trim contenteditable>
it('check if called or not called', () => {
	var spy = sinon.spy()
	var proxy = index.myFunction(spy)

	assert(spy.notCalled)

	proxy()

	assert(spy.called)
})
	
						</code></pre>
					</section>

					<section>
						<h3>Spies</h3>
						<h4>Method Signatures</h4>
						<pre><code class="hljs" data-trim contenteditable>
// creating a spy as an anonymous function
var spy = sinon.spy(); // #1 method signature

// returns a new function which wraps the given function
var spy = sinon.spy(myFunc); // #2 method signature

// creates a spy and replaces the original method with the cspy
var spy = sinon.spy(object, "method"); // #3 method signature
// Achtung!! call object.method.restore()
	
						</code></pre>
					</section>
					
					<section>
						<h3>Spies</h3>
						<h4>Properties</h4>
						<p>spy.withArgs(arg1[, arg2, ...]);</p>
						<pre><code class="hljs" data-trim contenteditable>
"should call method once with each argument": function () {
    var object = { method: function () {} };
    var spy = sinon.spy(object, "method");

    object.method(42);
    object.method(1);

    assert(spy.withArgs(42).calledOnce);
    assert(spy.withArgs(1).calledOnce);
}
	
						</code></pre>
					</section>
					<section>
						
						<h3>Spies</h3>
						<h4>Properties</h4>
						<pre><code class="hljs" data-trim contenteditable style="text-align: center">
							
							callCount
							called
							notCalled
							calledOnce
							calledTwice
							calledThrice
							firstCall
							secondCall
							thirdCall
							lastCall

							calledBefore(anotherSpy)
							calledAfter(anotherSpy)
							calledImmediatelyBefore(anotherSpy)
							calledImmediatelyAfter(anotherSpy)
							calledOn(obj)
							alwaysCalledOn(obj)
							calledWith(arg1, arg2, ...)
							alwaysCalledWith(arg1, arg2, ...)
							neverCalledWith(arg1, arg2, ...)
							calledWithNew()
							
							threw()
							threw("TypeError")
							alwaysThrew()
							returned(obj)
							alwaysReturned(obj)
							
							reset()
							restore()
						</code></pre>
					</section>

						<section>
							<h3>Spies</h3>
							<h4>Spy Calls</h4>
							var spyCall = spy.getCall(n)

							<pre><code class="hljs" data-trim contenteditable>
sinon.spy(jQuery, "ajax");

jQuery.ajax("/stuffs");

var spyCall = jQuery.ajax.getCall(0);

assertEquals("/stuffs", spyCall.args[0]);
							</code></pre>
						</section>
					</section>
				</section>
				
				<section>
					<section>
					<h3>Stubs</h3>
					<h4>What are stubs?</h4>
					<p>Test stubs are functions (spies) with pre-programmed behavior.</p>
					<p>They support the full test spy API in addition to methods which can be used to alter the stub’s behavior.</p>
					<p>As spies, stubs can be either anonymous, or wrap existing functions. When wrapping an existing function with a stub, the original function is not called.</p>
					</section>

					<section>
					<h3>Stubs</h3>
					<h4>When to use stubs?</h4>
					<ol>
						<li>Control a method’s behavior from a test to force the code down a specific path. Examples include forcing a method to throw an error in order to test error handling.</li>
						<li>When you want to prevent a specific method from being called directly (possibly because it triggers undesired behavior, such as a XMLHttpRequest or similar).</li>
					</ol>
					</section>

					<section>
					<h3>Stubs</h3>
					<h4>Creating Stubs</h4>
					<pre><code class="hljs" data-trim contenteditable>
						// Creates an anonymous function
						var stub = sinon.stub();

						// Replaces object.method with a stub function
						var stub = sinon.stub(object, "method");

						// Replaces object.method with a func, wrapped in a spy.
						var stub = sinon.stub(object, "method", func);

						// Stubs all the object’s methods.
						var stub = sinon.stub(obj);
					</code></pre>
					</section>
					
					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<p>stub.withArgs(arg1[, arg2, ...]);</p>
					<pre><code class="hljs" data-trim contenteditable>
it("test should stub method differently based on arguments", function () {
    var stub = sinon.stub();
    stub.withArgs(42).returns(1);
    stub.withArgs(1).throws("TypeError");

    stub(); // No return value, no exception
    stub(42); // Returns 1
    stub(1); // Throws TypeError
})
					</code></pre>
					</section>
					
					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<p>stub.onCall(n);</p>
					<pre><code class="hljs" data-trim contenteditable>
it("test should stub method differently on consecutive calls", function () {
    var stub = sinon.stub();
    stub.onCall(0).returns(1);
    stub.onCall(1).returns(2);
    stub.returns(3);

    stub(); // Returns 1
    stub(); // Returns 2
    stub(); // All following calls return 3
})
					</code></pre>
					<p>onFirstCall, onSecondCall, onThirdCall</p>
					</section>
				
					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<p>Resets both behaviour and history of the stub.</p>
					<pre><code class="hljs" data-trim contenteditable>stub.reset();</code></pre>
					<p>Resets history of the stub.</p>
					<pre><code class="hljs" data-trim contenteditable>stub.resetHistory();</code></pre>
					</section>

					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<p>callsFake(fakeFunction);</p>
					<pre><code class="hljs" data-trim contenteditable>
var myObj = {};
myObj.prop = function propFn() {
    return 'foo';
};

sinon.stub(myObj, 'prop').callsFake(function fakeFn() {
    return 'bar';
});

myObj.prop(); // 'bar'	
					</code></pre>
					</section>

					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<pre><code class="hljs" data-trim contenteditable>sinon.addBehavior(name, fn);</code></pre>
					Add a custom behavior. The name will be available as a function on stubs
					<pre><code class="hljs" data-trim contenteditable>
const sinon = require('sinon');

sinon.addBehavior('returnsNum', (fake, n) => fake.returns(n));

var stub = sinon.stub().returnsNum(42);

assert.equals(stub(), 42);
					</code></pre>
					</section>
					
					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<pre><code class="hljs" data-trim contenteditable>stub.get(getterFn)</code></pre>
					Replaces a new getter for this stub.
					<pre><code class="hljs" data-trim contenteditable>
var myObj = {
    prop: 'foo'
};

sinon.stub(myObj, 'prop').get(function getterFn() {
    return 'bar';
});

myObj.prop; // 'bar'
					</code></pre>
					</section>
					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<pre><code class="hljs" data-trim contenteditable>stub.set(setterFn)</code></pre>
					Defines a new setter for this stub.
					<pre><code class="hljs" data-trim contenteditable>
var myObj = {
    example: 'oldValue',
    prop: 'foo'
};

sinon.stub(myObj, 'prop').set(function setterFn(val) {
    myObj.example = val;
});

myObj.prop = 'baz';

myObj.example; // 'baz'
					</code></pre>
					</section>
					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<pre><code class="hljs" data-trim contenteditable>stub.value(newVal)</code></pre>
					Restores values for this stub.
					<pre><code class="hljs" data-trim contenteditable>
var myObj = {
    example: 'oldValue',
};

var stub = sinon.stub(myObj, 'example').value('newValue');
stub.restore()

myObj.example; // 'oldValue'
					</code></pre>
					</section>
					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					<pre><code class="hljs" data-trim contenteditable>stub.restore()</code></pre>
					Defines a new value for this stub.
					<pre><code class="hljs" data-trim contenteditable>
var myObj = {
    example: 'oldValue',
};

sinon.stub(myObj, 'example').value('newValue');

myObj.example; // 'newValue'
					</code></pre>
					</section>

					<section>
					<h3>Stubs</h3>
					<h4>Properties</h4>
					Some properties
					<pre><code class="hljs" data-trim contenteditable>
stub.returns(obj);
stub.returnsArg(index);
stub.returnsThis();
stub.resolves(value);
stub.rejects();
stub.rejects(value);
stub.throws();
					</code></pre>
					...
					</section>

				</section> <!-- end stubs -->
				
				<section> <!-- start mocks --> 
					<section>
					<h3>Mocks</h3>
					<h4>What are mocks?</h4>
					<p>Mocks are fake methods (like spies) with pre-programmed behavior (like stubs) as well as pre-programmed expectations.</p>
					</section>

					
				</section><!-- end mocks -->
				
				<section>
					<h3>Fake timers</h3>
				</section>
				
				<section>
					<h3>Fake XHR and servers</h3>
				</section>
				
				<section>
					<h3>Sandboxes</h3>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
